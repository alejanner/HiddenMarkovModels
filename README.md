# HiddenMarkovModels

DNA Markov Model Classifier

This repository contains a Streamlit application that estimates how likely a given DNA sequence is generated by a reference Markov model. It uses a 2nd-order Markov model (trinucleotides) to compute a log-probability for each input sequence, then compares it against a simulated distribution to generate a Z-score or percentile.
Overview

    Reference Genome / Markov Model

        The user provides a reference genome (single or multi-FASTA).

        The app constructs a 2nd-order Markov model from this reference, computing transition probabilities for trinucleotides.

    Sequence Classification

        The user uploads one or more DNA sequences (via multi-FASTA, text input, or a ZIP of multiple FASTA files).

        Each sequence’s log-probability under the Markov model is computed.

        The app simulates random sequences (of the same length) from the Markov model to estimate a distribution of log-probabilities, from which it calculates a mean and standard deviation.

        Using these statistics, the app assigns either:

            Z-score: (observed - mean) / std

            Rank (percentile): The fraction of simulated values below the observed log-probability.

    Output

        The app displays a table of results (one row per input sequence), including:

            Sequence ID

            log_p_seq (the raw log probability)

            log_p_per_nt (log probability normalized by sequence length)

            The final score (Z-score or percentile)

        A PDF report with the classification table can be downloaded.

        An Excel file of the “Top 100” sequences (sorted by score) can also be downloaded.

        Optionally, the user can compare Z-scores with an external Euclidean distance (or other metric). The app can merge on sequence ID, produce a combined table, and generate a Z-score vs. Distance scatter plot.

How the Algorithm Works

    Markov Model Construction

        Given a reference genome GG, we count all 2-mers and 3-mers in GG.

        The probability of a given 2-mer is approximated by its frequency in GG.

        The probability of a 3-mer is approximated by its conditional frequency given the preceding 2-mer.

        These probabilities form a 2nd-order Markov model, capturing how nucleotides follow each 	other in the reference.

    Log Probability Calculation

        For each sequence SS of length LL, we compute:
        log⁡P(S)=log⁡P(S1..2)+∑i=3Llog⁡P(Si∣Si−2,Si−1)
        logP(S)=logP(S1..2​)+i=3∑L​logP(Si​∣Si−2​,Si−1​)

        using the conditional probabilities from the reference model.

        Because these probabilities can be very small, we work in log space to avoid floating-

	point underflow.

    Simulation / Distribution

        To interpret log⁡P(S)logP(S), the app simulates N_sim random sequences of length LL from 	the same Markov model.

        It calculates the log probability per nucleotide for each simulated sequence, storing 		these in a distribution.

        The mean (μμ) and standard deviation (σσ) of that distribution are used to compute:
        
	Z=((log⁡P(S)/L)−μ)/σ)

        or to compute a percentile value.

    Z-score or Percentile

        If the user selects Z-score, each sequence’s log probability (per nt) is standardized 		relative to the simulation distribution.

        If the user selects percentile, the score is the fraction of simulated values less than 	the observed value (an empirical rank).

    Euclidean Distance Comparison (Optional)

        If the user has another metric (e.g., distance) for each sequence ID, the app merges the 	two data sources on seq_id.

        It can then generate a scatter plot of Z-score vs. Distance for the overlapping IDs.

Features

    Multiple Input Methods: Upload multi-FASTA, paste sequences, or upload a ZIP of FASTA files.

    Adaptive N_sim: The number of simulations depends on the sequence length (shorter sequences 	get fewer simulations, longer sequences get more).

    Export Options:

        A PDF containing a classification table.

        An Excel of the top 100 scored sequences.

        (Optional) Merged Excel for Z-score & distance.

    Plot Downloads (optional): The user can download plots as PNG files instead of seeing them 		inline.

Usage Instructions

    Run the App Locally

        Clone this repository and install dependencies (e.g., pip install -r requirements.txt).

        Launch Streamlit:

        streamlit run dna_markov_app.py

        Go to the printed local URL (often http://localhost:8501) in your web browser.

    Upload Reference Genome

        Choose either a default snippet or provide a custom FASTA file.

    Provide Sequences to Classify

        Option 1: Upload a multi-FASTA.

        Option 2: Paste sequences (one per line).

        Option 3: Upload a ZIP file containing multiple FASTA files.

    Choose Scoring Method

        Z-score or Percentile.

        Click “Analyze” to run the classification.

    Review & Download

        View a preview of the results in the app.

        Download a PDF of the full classification table or an Excel file of the Top 100.

        (Optional) Provide a file containing distance metrics to compare with the Z-score. Merge 	& download if desired.


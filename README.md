# DNA Markov Model Classifier

A **Streamlit** application that estimates how likely each DNA sequence is generated by a reference Markov model.  
It uses a **2nd-order Markov model (trinucleotides)** to compute a log-probability of each DNA sequence and compares it against a simulated distribution to generate either a **Z-score** or a **percentile**.

---

## Table of Contents
1. [Overview](#overview)
2. [Markov Model & Algorithm Details](#markov-model--algorithm-details)
3. [Features](#features)
4. [Usage](#usage)
5. [Requirements](#requirements)
6. [Deployment](#deployment)


---

## Overview

This app:
- Builds a 2nd-order Markov model from a **reference genome** (FASTA).
- Calculates a **log-probability** for each input DNA sequence under that model.
- Simulates multiple random sequences of the same length to derive a **distribution** (mean & std or percentile).
- Provides a **score** (either a **Z-score** or **Rank percentile**).
- Offers **PDF** and **Excel** reports, plus optional **distance metric** comparison.

---

## Markov Model & Algorithm Details

1. **Reference Genome**  
   - The user uploads (or uses a default) reference genome in FASTA format.  
   - We count **2-mers** and **3-mers** in the reference.  
   This builds probabilities:![Equation 1](https://render.githubusercontent.com/render/math?math=P(\text{2-mer}))
   and ![Equation 2](https://render.githubusercontent.com/render/math?math=P(\text{3-mer}|\text{2-mer}))


2. **Score Calculation**  
   1. **Log Probability**  
      \[
      \log P(S) = \log P(S_{1..2}) \;+\; \sum_{i=3}^{L} \log P\bigl(S_i \mid S_{i-2}, S_{i-1}\bigr).
      \]  
      We work in **log space** to handle very small probabilities safely.

   2. **Simulation**  
      - For each sequence length \(L\), the app generates **N_sim** random sequences from the Markov model.  
      - These yield an empirical distribution of \(\log P(S) / L\).

   3. **Z-score or Percentile**  
      - **Z-score**: \(\displaystyle Z = \frac{(\log P(S)/L) - \mu}{\sigma}\), using the simulation’s mean \(\mu\) and standard deviation \(\sigma\).  
      - **Rank**: The fraction of simulated values that are less than \(\log P(S)/L\), giving a percentile.

3. **Optional Euclidean Distance Comparison**  
   - If the user has a table with **distance metrics** for each sequence (identified by `seq_id`), the app can **merge** them on `seq_id`, then plot **Z-score vs. Distance**.

---

## Features

- **Multiple Input Methods**:  
  - Upload multi-FASTA, paste sequences, or upload a ZIP of FASTA files.
- **Adaptive Simulation**:  
  - The number of simulated sequences (N_sim) scales with the sequence length.
- **Reports**:  
  - **PDF** with classification table.  
  - **Excel** with the “Top 100” scored sequences.  
- **Optional**:  
  - Merge and compare **Z-score** with another **distance metric**.  
  - Downloadable plots (PNG) of the score distribution or Z-score vs. distance.

---

## Usage

1. **Install Dependencies**  
   - Make sure you have Python 3.7+ installed.  
   - Install the required libraries (listed in [Requirements](#requirements)) or run:
     ```bash
     pip install -r requirements.txt
     ```

2. **Run the App**  
   - In the repository folder, execute:
     ```bash
     streamlit run dna_markov_app.py
     ```
   - This will launch a local web server; open the URL (often [http://localhost:8501](http://localhost:8501)) in your browser.

3. **Reference Genome**  
   - Choose a **default snippet** or **upload** your own FASTA.

4. **Sequences to Classify**  
   - **Upload** a multi-FASTA,  
   - **Paste** sequences,  
   - or **upload** a ZIP containing multiple FASTA files.

5. **Scoring Method**  
   - Choose **Z-score** or **Rank (percentile)**.

6. **Results & Reports**  
   - After classification, preview the results in the table.  
   - Download the **PDF** classification report or an **Excel** with the top 100 scores.

7. **Optional**: Merge Z-score with Distance  
   - If you used **Z-score**, you can upload a table with a distance column.  
   - The app merges on `seq_id`, generates a merged preview, and allows you to download a plot (PNG) or an Excel file of the merged data.

---

## Requirements

A typical `requirements.txt` might look like this:
```txt
streamlit==1.19.0
pandas==1.5.3
numpy==1.23.5
biopython==1.81
matplotlib==3.6.3
seaborn==0.12.2
scipy==1.9.3
fpdf==1.7.2

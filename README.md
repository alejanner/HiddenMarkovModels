# DNA Markov Model Classifier

A **Streamlit** application that estimates how likely each DNA sequence is generated by a reference Markov model.  
It uses a **2nd-order Markov model (trinucleotides)** to compute a log-probability of each DNA sequence and compares it against a simulated distribution to generate either a **Z-score** or a **percentile**.

---

## Table of Contents
1. [Overview](#overview)
2. [Markov Model & Algorithm Details](#markov-model--algorithm-details)
3. [Features](#features)
4. [Usage](#usage)
5. [Requirements](#requirements)
6. [Deployment](#deployment)

---

## Overview

This app:
- Builds a 2nd-order Markov model from a **reference genome** (FASTA).
- Calculates a **log-probability** for each input DNA sequence under that model.
- Simulates multiple random sequences of the same length to derive a **distribution** (mean & std or percentile).
- Provides a **score** (either a **Z-score** or **Rank percentile**).
- Offers **PDF** and **Excel** reports, plus optional **distance metric** comparison.

---

## Markov Model & Algorithm Details

1. **Reference Genome**  
   - The user uploads (or uses a default) reference genome in FASTA format.  
   - We count **2-mers** and **3-mers** in the reference.  
   This builds probabilities  
   ![Equation 1](https://render.githubusercontent.com/render/math?math=P(\text{2-mer}))  
   and  
   ![Equation 2](https://render.githubusercontent.com/render/math?math=P(\text{3-mer}%7C\text{2-mer})).

2. **Score Calculation**  
   1. **Log Probability**  

      Instead of raw LaTeX, we use an inline image:

      ![Equation - Log P(S)](https://render.githubusercontent.com/render/math?math=%5Clog%20P(S)%20%3D%20%5Clog%20P(S_%7B1..2%7D)%20%2B%20%5Csum_%7Bi%3D3%7D%5E%7BL%7D%20%5Clog%20P%5Cbigl(S_i%20%5Cmid%20S_%7Bi-2%7D%2C%20S_%7Bi-1%7D%5Cbigr).)

      We work in **log space** to handle very small probabilities safely.

   2. **Simulation**  
      - For each sequence length ![L](https://render.githubusercontent.com/render/math?math=L), the app generates **N_sim** random sequences from the Markov model.  
      - These yield an empirical distribution of  
        ![Equation - logP(S)/L](https://render.githubusercontent.com/render/math?math=%5Clog%20P(S)%20%2F%20L).

   3. **Z-score or Percentile**  
      - **Z-score**:  
        ![Equation - Z-score](https://render.githubusercontent.com/render/math?math=Z%20%3D%20%5Cfrac%7B%5Cbigl(%5Clog%20P(S)%2F%20L%5Cbigr)%20-%20%5Cmu%7D%7B%5Csigma%7D)

        using the simulation’s mean  
        ![mu](https://render.githubusercontent.com/render/math?math=%5Cmu)  
        and standard deviation  
        ![sigma](https://render.githubusercontent.com/render/math?math=%5Csigma).

      - **Rank**: The fraction of simulated values less than  
        ![logP(S)/L](https://render.githubusercontent.com/render/math?math=%5Clog%20P(S)%2F%20L),
        yielding a percentile.

3. **Optional Euclidean Distance Comparison**  
   - If the user has a table with **distance metrics** for each sequence (identified by `seq_id`), the app can **merge** them on `seq_id`, then plot **Z-score vs. Distance**.

---

## Features

- **Multiple Input Methods**:  
  - Upload multi-FASTA, paste sequences, or upload a ZIP of FASTA files.
- **Adaptive Simulation**:  
  - The number of simulated sequences (N_sim) scales with the sequence length.
- **Reports**:  
  - **PDF** with classification table.  
  - **Excel** with the “Top 100” scored sequences.  
- **Optional**:  
  - Merge and compare **Z-score** with another **distance metric**.  
  - Downloadable plots (PNG) of the score distribution or Z-score vs. distance.

---

## Usage

1. **Install Dependencies**  
   - Make sure you have Python 3.7+ installed.  
   - Install the required libraries (listed in [Requirements](#requirements)) or run:
     ```bash
     pip install -r requirements.txt
     ```

2. **Run the App**  
   - In the repository folder, execute:
     ```bash
     streamlit run dna_markov_app.py
     ```
   - This will launch a local web server; open the URL (often [http://localhost:8501](http://localhost:8501)) in your browser.

3. **Reference Genome**  
   - Choose a **default snippet** or **upload** your own FASTA.

4. **Sequences to Classify**  
   - **Upload** a multi-FASTA,  
   - **Paste** sequences,  
   - or **upload** a ZIP containing multiple FASTA files.

5. **Scoring Method**  
   - Choose **Z-score** or **Rank (percentile)**.

6. **Results & Reports**  
   - After classification, preview the results in the table.  
   - Download the **PDF** classification report or an **Excel** with the top 100 scores.

7. **Optional**: Merge Z-score with Distance  
   - If you used **Z-score**, you can upload a table with a distance column.  
   - The app merges on `seq_id`, generates a merged preview, and allows you to download a plot (PNG) or an Excel file of the merged data.

---
